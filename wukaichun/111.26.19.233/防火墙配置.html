
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<meta name="renderer" content="webkit"/>
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
<link href="cn/css/metro/bootstrap.min.css" rel="stylesheet" />
<link href="cn/css/metro/bootstrap-responsive.min.css" rel="stylesheet" />
<link href="cn/css/metro/font-awesome.css" rel="stylesheet" />
<link href="cn/css/metro/style.css" rel="stylesheet" />
<link href="cn/css/metro/style-responsive.css" rel="stylesheet" />
<link href="cn/css/metro/style-default.css" rel="stylesheet" id="style_color" />
<script src="cn/jscript/reg.js" type="text/javascript"></script>
<script src="cn/jscript/md5.js" type="text/javascript"></script>
<script src="cn/jscript/metro/jquery-1.8.3.min.js" type="text/javascript"></script>
<style>
#form1 td{
white-space: nowrap;
}
form[name=form1] td{
white-space: nowrap;
}
</style>
<title></title>
</head>
<body style="background:#FFFFFF;">
<div class="container-fluid" style="margin-top:60px;">
    <div class="row-fluid">
       <div class="span12"> 
           <ul class="breadcrumb" style="margin:20px 0 0 0;position: relative">
               <li>
                   <a href="主页面.html" target="mainFrame">首页</a>
                   <span class="divider">/</span>
               </li>
                              <li><a href="系统配置.html" target="mainFrame">系统配置</a><span class="divider">/</span></li>
                                             <li><a href="javascript:;" target="mainFrame">防火墙配置</a></li>
                              <div style="position: absolute;top:5px;right:5px;">
                <button class="btn btn-warning" onclick="history.back(-1)" title="Back"><i class="icon-arrow-left"></i></button>&nbsp;
               <button class="btn btn-info" onclick="window.location.reload();" title="Refresh"><i class="icon-refresh"></i></button>
               </div>
           </ul>
       </div><link href="cn/css/metro/jquery.fancybox.css" rel="stylesheet" />
<link href="cn/css/metro/bootstrap-dialog.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="cn/css/metro/uniform.default.css" />
<div class="row-fluid">
    <div class="span12">
	<style>
	.even-row{background-color:#DFEFFC;}
	.odd-row{background-color:#F5F8F9;}
	textarea,input[type="text"]{margin-top: 10px;}
	</style>
	<form id="addFormData" name="formData">
		<table width="100%" style="margin-top:10px;">
			<tr>
				<td>
					<table width="100%" class="data-table1" border="0" cellpadding="0" cellspacing="0">
				    	<colgroup><col width="30%">
				            <col width="70%">
				        </colgroup>
				        <tbody>
				        <tr height="25px" class="even-row">
				        	<td style="padding-left: 15px;">TCP端口</td>
				            <td>
				            	<input type="text" style="width:auto" name="tcp_open_ports" size="64" value="69|80|161|389|443|1260|2222|5065|6001|8008">
				            	<span style="color:green">(格式:22|80|5060)</span>
				            </td>
				        </tr>
				        <tr height="25px" class="odd-row">
				        	<td style="padding-left: 15px;">UDP端口</td>
				            <td>
				            	<input type="text" style="width:auto" name="udp_open_ports" size="64" value="123|5060|9092|5062|9001">
				            	<span style="color:green">(格式:22|80|5060)</span>
				            </td>
				        </tr>
				        <tr height="25px" class="even-row">
				        	<td style="padding-left: 15px;">RTP端口范围</td>
				            <td>
				            	<input type="text" name="udp1" size="18" value="10000" validator='regInt'>&nbsp;--&nbsp;<input type="text" name="udp2" size="18" value="40000" validator='regInt'>
				            	<span style="color:green">(1--65535)</span>
				            </td>
				        </tr>
				        <tr height="25px" class="odd-row">
				        	<td style="padding-left: 15px;">SIP端口范围</td>
				            <td>
				            	<input type="text" name="proxyport_start" size="18" value="9100" validator='regInt'>&nbsp;--&nbsp;<input type="text" name="proxyport_end" size="18" value="9160" validator='regInt'>
				            	<span style="color:green">(1--65535)</span>
				            </td>
				        </tr>
				        <tr height="25px" class="even-row">
				        	<td style="padding-left: 15px;">允许回应ICMP请求</td>
				            <td>
				           		<select name="icmpflag" id="icmpflag" style="width:151 ;font-size: 9pt; font-family: 宋体">
							    	<option value="1">是</option>
							    	<option value="0">否</option>
							    </select>
				            </td>
				        </tr>
				        <tr height="25px" class="odd-row">
				        	<td style="padding-left: 15px;">限制的来源IP地址</td>
				            <td>
				            	<textarea id="blacklist_ips" name="blacklist_ips" rows="3" cols="50"></textarea>
				            	<span style="color:green">(格式:192.168.139.102|192.168.139.108)</span>
				            </td>
				        </tr>
						</tbody>
					</table>
				</td>
			</tr>
			<tr height="10">
				<td>
				<input type="hidden" name="subflag" value="020102">
				<input type="hidden" name="action" value="update">
				</td>
			</tr>
						<tr>
		        <td><span class="btn btn-primary" onclick="confirmBut()">设置</span></td>
		    </tr>
		    		</table>
	</form>	

	</div>
</div>
<div id="ajaxMask" style="display:none;width:100%;height:100%;background-color:#000;position:absolute;top:0;left:0;z-index:10000;opacity:0.8;filter: alpha(opacity=80);">
    <div style="top:45%;left:45%;width:125px;height:25px;position:absolute;z-index:10001; background-color:#FFFFFF;line-height:25px;text-align: center;">
        <img src="cn/img/loading.gif" style="vertical-align:middle;"/> Loading...
    </div>
</div>	</div>
</div>
</body>
</html>
<script src="cn/jscript/metro/bootstrap.min.js"></script>
<script src="cn/jscript/metro/jquery.blockui.js"></script>
<script src="cn/jscript/metro/jquery.nicescroll.js" type="text/javascript"></script>
<script src="cn/jscript/metro/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="cn/jscript/metro/jquery.scrollto.min.js"></script>
<script src="cn/jscript/metro/common-scripts.js"></script>
<script src="cn/jscript/metro/bootstrap-dialog.min.js"></script>
<script type="text/javascript" src="cn/jscript/tp/mybase_new.js"></script><script language="javascript">
$("#icmpflag").val('1');
function confirmBut() {

	BootstrapDialog.confirm({
        title: '警告',
        message: '确定要修改防火墙开放端口吗？',
		btnCancelLabel: '取消',
        btnOKLabel: '确定',
        callback:function(result){
	        if(result) {
			    $.ajax({
			       type: "POST",
			       url: "admin.php?op=servicemgr_iptables",
			       data: $("#addFormData").serialize(),
			       dataType:'json',
			        beforeSend: function () {
			           ShowLoading();
			        },
			        complete: function () {
			            HiddenLoading();
			        },
			       success: function(res){
			        if(res.code=='00'){
			            alert(res.text);
			            location.href = 'admin.php?op=servicemgr_iptables&subflag=020102';
			        }else{
			            alert(res.text);
			        }
			       },
			       error: function(XMLHttpRequest, textStatus, errorThrown) {
			            alert('error');
			            console.log(XMLHttpRequest.status+'|'+XMLHttpRequest.readyState+'|'+textStatus);
			       }
			    });
	        }
        }
	})

	if(!isEmpty($("#blacklist_ips").val())){

		BootstrapDialog.confirm({
	        title: '警告',
	        message: '限制的来源IP地址将被加入防火墙黑名单，阻止登录本服务器，确定要限制吗？',
			btnCancelLabel: '取消',
	        btnOKLabel: '确定',
	        callback:function(result){
		        if(result) {
				    $.ajax({
				       type: "POST",
				       url: "admin.php?op=servicemgr_iptables",
				       data: $("#addFormData").serialize(),
				       dataType:'json',
				        beforeSend: function () {
				           ShowLoading();
				        },
				        complete: function () {
				            HiddenLoading();
				        },
				       success: function(res){
				        if(res.code=='00'){
				            alert(res.text);
				            location.href = 'admin.php?op=servicemgr_iptables&subflag=020102';
				        }else{
				            alert(res.text);
				        }
				       },
				       error: function(XMLHttpRequest, textStatus, errorThrown) {
				            alert('error');
				            console.log(XMLHttpRequest.status+'|'+XMLHttpRequest.readyState+'|'+textStatus);
				       }
				    });
		        }
	        }
		})
	}
	return true;
}
</script>